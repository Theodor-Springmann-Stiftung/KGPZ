name: XML prüfen

on:
  push:
    paths:
      - 'XML/**/*.xml'
  pull_request:
    paths:
      - 'XML/**/*.xml'

jobs:
  XSD-Schema:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Python-Setup
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'
    
    - name: Abhängigkeiten installieren
      run: |
        python -m pip install --upgrade pip
        pip install lxml
    
    - name: XSD-Schema-Validierung
      run: python Scripts/lint_validation.py | tee validation_output.txt
      continue-on-error: true
    
    - name: GitHub-Anmerkungen für XSD-Validierung erstellen
      run: cat validation_output.txt | python Scripts/annotations_validation.py
      
    - name: Prüfe auf Validierungsfehler
      run: |
        if grep -q "Validierung fehlgeschlagen" validation_output.txt; then
          exit 1
        fi

  Verweise:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Python-Setup
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'
    
    - name: Abhängigkeiten installieren
      run: |
        python -m pip install --upgrade pip
        pip install lxml
      
    - name: Verweise prüfen 
      run: python Scripts/lint_verweise.py
      
    - name: GitHub-Anmerkungen für Referenzprüfung erstellen
      if: failure()
      run: python Scripts/annotations_references.py
